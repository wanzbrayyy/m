<nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top shadow-sm">
  <div class="container-fluid">
    <a class="navbar-brand fw-bold" href="/"><i class="fas fa-code-compare me-1"></i> SC Market</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavMarketplace" aria-controls="navbarNavMarketplace" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNavMarketplace">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a class="nav-link <%= (typeof titlePage !== 'undefined' && titlePage === 'Selamat Datang') ? 'active' : '' %>" href="/"><i class="fas fa-home fa-fw me-1"></i>Beranda</a>
        </li>
        <li class="nav-item">
          <a class="nav-link <%= (typeof titlePage !== 'undefined' && titlePage === 'Semua Source Code') ? 'active' : '' %>" href="/sc-list"><i class="fas fa-list-alt fa-fw me-1"></i>Semua SC</a>
        </li>
         <% if (currentUser && (currentUser.role === 'seller' || currentUser.role === 'admin')) { %>
          <li class="nav-item">
            <a class="nav-link <%= (typeof titlePage !== 'undefined' && titlePage === 'Tambah Source Code') ? 'active' : '' %>" href="/sc/add"><i class="fas fa-plus-circle fa-fw me-1"></i>Tambah SC</a>
          </li>
        <% } %>
        <% if (currentUser && currentUser.role === 'admin') { %>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle <%= (typeof titlePage !== 'undefined' && ['Manajemen Pengguna', 'Manajemen Source Code', 'Manajemen Tiket Bantuan'].includes(titlePage)) ? 'active' : '' %>" href="#" id="adminDropdownNav" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="fas fa-user-shield fa-fw me-1"></i>Admin Panel
            </a>
            <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="adminDropdownNav">
              <li><a class="dropdown-item <%= (typeof titlePage !== 'undefined' && titlePage === 'Manajemen Pengguna') ? 'active' : '' %>" href="/admin/users"><i class="fas fa-users-cog fa-fw me-2"></i>Manajemen User</a></li>
              <li><a class="dropdown-item <%= (typeof titlePage !== 'undefined' && titlePage === 'Manajemen Source Code') ? 'active' : '' %>" href="/admin/sc-management"><i class="fas fa-tasks fa-fw me-2"></i>Manajemen SC</a></li>
              <li><a class="dropdown-item <%= (typeof titlePage !== 'undefined' && titlePage === 'Manajemen Tiket Bantuan') ? 'active' : '' %>" href="/api/tickets/admin/all"><i class="fas fa-headset fa-fw me-2"></i>Manajemen Tiket</a></li>
            </ul>
          </li>
        <% } %>
      </ul>
      <ul class="navbar-nav ms-auto">
        <% if (currentUser) { %>
          <li class="nav-item">
             <a class="nav-link <%= (typeof titlePage !== 'undefined' && titlePage === 'Deposit Saldo') ? 'active' : '' %>" href="/dashboard/deposit" title="Saldo Anda">
                <i class="fas fa-wallet fa-fw me-1"></i>Rp <%= currentUser.balance.toLocaleString('id-ID') %>
             </a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle <%= (typeof titlePage !== 'undefined' && ['Dashboard', 'Edit Profile & Toko', 'Riwayat Pesanan', 'Riwayat Transaksi', 'Tiket Bantuan Saya', 'Source Code Saya', 'Analitik Penjualan'].includes(titlePage)) ? 'active' : '' %>" href="#" id="userDropdownNav" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <img src="<%= currentUser.profilePicture %>" alt="<%= currentUser.name %>" class="rounded-circle me-1" width="24" height="24" style="object-fit:cover;"> <%= currentUser.name %>
            </a>
            <ul class="dropdown-menu dropdown-menu-dark dropdown-menu-end" aria-labelledby="userDropdownNav">
              <li><a class="dropdown-item <%= (typeof titlePage !== 'undefined' && titlePage === 'Dashboard') ? 'active' : '' %>" href="/dashboard"><i class="fas fa-tachometer-alt fa-fw me-2"></i>Dashboard</a></li>
              <li><a class="dropdown-item <%= (typeof titlePage !== 'undefined' && titlePage === 'Edit Profile & Toko') ? 'active' : '' %>" href="/dashboard/profile"><i class="fas fa-user-edit fa-fw me-2"></i>Edit Profile & Toko</a></li>
              <% if (currentUser.role === 'seller' || currentUser.role === 'admin') { %>
                <li><a class="dropdown-item" href="/dashboard/profile#qris-settings"><i class="fas fa-qrcode fa-fw me-2"></i>Pengaturan QRIS</a></li>
                <li><a class="dropdown-item <%= (typeof titlePage !== 'undefined' && titlePage === 'Source Code Saya') ? 'active' : '' %>" href="/dashboard/my-sc"><i class="fas fa-code-branch fa-fw me-2"></i>Source Code Saya</a></li>
                <li><a class="dropdown-item <%= (typeof titlePage !== 'undefined' && titlePage === 'Analitik Penjualan') ? 'active' : '' %>" href="/dashboard/analytics"><i class="fas fa-chart-line fa-fw me-2"></i>Analitik Penjualan</a></li>
              <% } %>
              <li><a class="dropdown-item <%= (typeof titlePage !== 'undefined' && titlePage && titlePage.startsWith('Tiket Bantuan')) ? 'active' : '' %>" href="/api/tickets"><i class="fas fa-life-ring fa-fw me-2"></i>Tiket Bantuan Saya</a></li>
              <li><a class="dropdown-item <%= (typeof titlePage !== 'undefined' && titlePage === 'Deposit Saldo') ? 'active' : '' %>" href="/dashboard/deposit"><i class="fas fa-money-bill-wave fa-fw me-2"></i>Deposit Saldo</a></li>
              <li><a class="dropdown-item <%= (typeof titlePage !== 'undefined' && titlePage === 'Riwayat Pesanan') ? 'active' : '' %>" href="/dashboard/orders"><i class="fas fa-history fa-fw me-2"></i>Pesanan Saya</a></li>
              <li><a class="dropdown-item <%= (typeof titlePage !== 'undefined' && titlePage === 'Riwayat Transaksi') ? 'active' : '' %>" href="/dashboard/transactions"><i class="fas fa-exchange-alt fa-fw me-2"></i>Riwayat Transaksi</a></li>
              <li><hr class="dropdown-divider"></li>
              <li><a class="dropdown-item" href="/logout"><i class="fas fa-sign-out-alt fa-fw me-2"></i>Logout</a></li>
            </ul>
          </li>
        <% } else { %>
          <li class="nav-item">
            <a class="nav-link <%= (typeof titlePage !== 'undefined' && titlePage === 'Login') ? 'active' : '' %>" href="/login"><i class="fas fa-sign-in-alt fa-fw me-1"></i>Login</a>
          </li>
          <li class="nav-item">
            <a class="nav-link <%= (typeof titlePage !== 'undefined' && titlePage === 'Register Akun') ? 'active' : '' %>" href="/register"><i class="fas fa-user-plus fa-fw me-1"></i>Register</a>
          </li>
        <% } %>
      </ul>
    </div>
  </div>
</nav>