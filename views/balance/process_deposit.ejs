<h1><i class="fas fa-spinner fa-spin"></i> Memproses Pembayaran...</h1>
<p>Anda akan diarahkan ke halaman pembayaran Midtrans. Mohon tunggu.</p>
<hr>
<div id="snap-container" style="max-width: 600px; margin: auto;"></div>

<script type="text/javascript"
    src="<%= midtransIsProduction ? 'https://app.midtrans.com/snap/snap.js' : 'https://app.sandbox.midtrans.com/snap/snap.js' %>"
    data-client-key="<%= clientKey %>"></script>
<script type="text/javascript">
    function pay() {
        snap.pay('<%= snapToken %>', {
            onSuccess: function(result){
                console.log('success');
                console.log(result);
                window.location.href = result.finish_redirect_url || "/dashboard/deposit/status?order_id=" + result.order_id + "&status_code=" + result.status_code + "&transaction_status=success";
            },
            onPending: function(result){
                console.log('pending');
                console.log(result);
                window.location.href = result.finish_redirect_url || "/dashboard/deposit/status?order_id=" + result.order_id + "&status_code=" + result.status_code + "&transaction_status=pending";
            },
            onError: function(result){
                console.log('error');
                console.log(result);
                window.location.href = result.finish_redirect_url || "/dashboard/deposit/status?order_id=" + result.order_id + "&status_code=" + result.status_code + "&transaction_status=error";
            },
            onClose: function(){
                console.log('customer closed the popup without finishing the payment');
                // Anda bisa redirect ke halaman status atau dashboard
                window.location.href = "/dashboard/deposit/status?order_id=CLOSED&transaction_status=closed";
            }
        });
    }
    // Panggil fungsi pay saat halaman dimuat
    // Tunggu sebentar agar snap.js sempat terload
    setTimeout(pay, 500);
</script>