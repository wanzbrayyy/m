<h1><i class="fas fa-exchange-alt"></i> Riwayat Transaksi</h1>
<p>Saldo Anda saat ini: <strong>Rp <%= user.balance.toLocaleString('id-ID') %></strong></p>
<hr>
<% if (transactions && transactions.length > 0) { %>
<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th>Tanggal</th>
                <th>Tipe</th>
                <th>Deskripsi</th>
                <th>Jumlah (Rp)</th>
                <th>Metode</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            <% transactions.forEach(trx => { %>
            <tr>
                <td><%= new Date(trx.createdAt).toLocaleString('id-ID', { dateStyle: 'medium', timeStyle: 'short'}) %></td>
                <td>
                    <% if (trx.type === 'deposit') { %><span class="badge bg-success">Deposit</span><% } %>
                    <% if (trx.type === 'purchase_sc') { %><span class="badge bg-primary">Beli SC</span><% } %>
                    <% if (trx.type === 'rent_sc') { %><span class="badge bg-info">Sewa SC</span><% } %>
                </td>
                <td>
                    <%= trx.description %>
                    <% if (trx.sourceCode && trx.sourceCode.title) { %>
                        <br><small><a href="/sc/<%= trx.sourceCode._id %>"><%= trx.sourceCode.title %></a></small>
                    <% } %>
                     <% if (trx.midtransOrderId) { %>
                        <br><small class="text-muted">Order ID: <%= trx.midtransOrderId %></small>
                    <% } %>
                </td>
                <td class="<%= trx.amount > 0 ? 'text-success' : 'text-danger' %>">
                    <%= trx.amount.toLocaleString('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }) %>
                </td>
                <td><%= trx.paymentMethod %></td>
                <td>
                    <span class="badge 
                        <%= trx.status === 'success' ? 'bg-success' : '' %>
                        <%= trx.status === 'pending' ? 'bg-warning text-dark' : '' %>
                        <%= ['failed', 'cancelled', 'expired'].includes(trx.status) ? 'bg-danger' : '' %>
                    ">
                        <%= trx.status %>
                    </span>
                </td>
            </tr>
            <% }) %>
        </tbody>
    </table>
</div>
<% } else { %>
<div class="alert alert-info">
    <i class="fas fa-info-circle"></i> Belum ada riwayat transaksi.
</div>
<% } %>
<a href="/dashboard/deposit" class="btn btn-primary mt-3"><i class="fas fa-wallet"></i> Deposit Saldo</a>